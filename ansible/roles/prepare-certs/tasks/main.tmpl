---
- name: "Création d'une Autorité de Certification"
  shell: "cfssl gencert -initca /home/vagrant/on-demand-infra/certs/ca-csr.json | cfssljson -bare ca"

- name: "Génération du certificat Admin Client"
  shell: "cfssl gencert \
            -ca=ca.pem \
            -ca-key=ca-key.pem \
            -config=/home/vagrant/on-demand-infra/certs/ca-config.json \
            -profile=kubernetes \
            /home/vagrant/on-demand-infra/certs/admin-csr.json | cfssljson -bare admin"

- name: "Génération du certificat Client Kubelet"
  shell: "cfssl gencert \
            -ca=ca.pem \
            -ca-key=ca-key.pem \
            -config=/home/vagrant/on-demand-infra/certs/ca-config.json \
            -hostname=$master-a,${master-a-ext-ip},${master-a-int-ip} \
            -profile=kubernetes \
            /home/vagrant/on-demand-infra/certs/master-a-csr.json | cfssljson -bare master-a"


